{{define "main"}}
<h2>Upload</h2>
<form id="upload-form">
    <input type="file" name="image" />
    <input type="submit" value="upload" />
</form>
<output id="upload-result"></output>


<script>
    const uploadForm = document.getElementById("upload-form");
    const uploadResult = document.getElementById("upload-result");
    uploadForm.addEventListener("submit", function (e) {
        e.preventDefault();
        console.debug("uploadForm submit");
        const formData = new FormData(uploadForm);
        fetch("/api/images", {
            method: "POST",
            body: formData,
        })
            .then(response => response.json())
            .then(data => {
                let innerHTML = "";
                if (data.status === 201) {
                    innerHTML = `
                        <h3>Upload Result</h3>
                        <ul>
                            <li>status: ${data.status}</li>
                            <li>Image ID: ${data.id}</li>
                            <li><a href="${data.url}" target="_blank" rel="noopener noreferrer">Image URL: ${data.url}</a></li>
                        </ul>`
                } else {
                    innerHTML = `
                        <h3>Upload Result</h3>
                        <ul>
                            <li>status: ${data.status}</li>
                            <li>error: ${data.error}</li>
                        </ul>`
                }

                uploadResult.innerHTML = innerHTML;
                uploadForm.reset();
                console.debug(innerHTML);
            })
    });
</script>
{{end}}